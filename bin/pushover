#!/usr/bin/env ruby

require 'pushover'

include Pushover
Options.parse!

# Order is important.
if Options[:config_file]
	puts "Selecting config file: #{Options[:config_file]}"
	Pushover::Config.save_file = Options[:config_file]
end

if Options[:save_app]
	puts "Saving application #{Options[:save_app][0]} to #{Options[:save_app][1]}."
	Pushover::App.add Options[:save_app][0], Options[:save_app][1]
	exit
end

if Options[:save_user]
	puts "Saving user #{Options[:save_user][0]} to #{Options[:save_user][1]}."
	Pushover::User.add Options[:save_user][0], Options[:save_user][1]
	exit
end
puts "Try pushover -h for help." if Options.empty? && ARGV.empty?

if ARGV
	if !Options[:appkey]
		puts "Must supply the api_key or keyname via --(a)pp"
		exit
	end

	if !Options[:user]
		puts "Must supply the username or token via --(u)ser."
		exit
	end

	api_key = Pushover::App.find Options[:appkey]
	user = Pushover::User.find Options[:user]

	response = Pushover.notification user, api_key, ARGV.join(" ")
	if response.code == 200
		puts "Message sent successfully!"
	else
		puts "#{response.code}: #{response.body}"
	end
end
